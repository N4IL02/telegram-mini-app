<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slots — Analyzer</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0b1320; --card:#0f1a2b; --panel:#0e1728; --panel2:#0a1322;
    --stroke:rgba(53,208,255,.18); --stroke2:rgba(53,208,255,.12);
    --accent:#ffb03a; --accent2:#ffd36b; --muted:#8ba5c7;
  }
  *{box-sizing:border-box}
  html,body{height:100%;}
  body{
    margin:0; color:#e8f5ff; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(900px 600px at 50% -150px, #152742 0, rgba(21,39,66,0) 55%),
      radial-gradient(600px 420px at -200px 100%, #0d1a30 0, rgba(13,26,48,0) 60%),
      radial-gradient(700px 500px at 120% 100%, #0d1a30 0, rgba(13,26,48,0) 60%),
      var(--bg);
    display:flex; justify-content:center; align-items:flex-start; padding:16px;
  }
  .shell{ width:100%; max-width:460px; display:flex; flex-direction:column; gap:16px; }

  /* Topbar */
  .topbar{ background:linear-gradient(180deg, #102036 0%, #0c182b 100%); border:1px solid var(--stroke2); border-radius:18px; padding:10px 12px; box-shadow:0 20px 50px -20px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05); display:flex; align-items:center; gap:10px; justify-content:space-between; }
  .back{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:14px; background:#0b1424; border:1px solid var(--stroke); color:#cfe1ff; font-weight:800; cursor:pointer; text-decoration:none; }
  .back:active{ filter:brightness(1.08) }
  .tgbadge{ display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:14px; background:linear-gradient(180deg, #0f1f33, #0c182b); border:1px solid var(--stroke2); font-weight:900; letter-spacing:.2px; }
  .tgicon{ width:32px; height:32px; border-radius:50%; display:block; box-shadow:0 0 0 6px rgba(53,208,255,.06), 0 8px 20px -8px rgba(53,208,255,.45); }
  .tgicon svg{ width:18px; height:18px; }

  /* Select */
  .select{ width:100%; background:#0b1526; border:1px solid var(--stroke); border-radius:12px; color:#eaf2ff; padding:12px; font-weight:700; outline:none; }

  /* Uploader */
  .drop{ position:relative; border-radius:16px; background:linear-gradient(180deg,#0b1424,#0a1120); border:2px dashed var(--stroke); height:200px; display:grid; place-items:center; text-align:center; padding:12px; }
  .drop .hint{ color:#a8c1e5; font-size:14px; }
  .drop input{ position:absolute; inset:0; opacity:0; cursor:pointer; }

  /* Preview */
  .preview{ position:relative; border-radius:16px; overflow:hidden; border:2px dashed var(--stroke); }
  .preview img{ width:100%; height:100%; object-fit:cover; display:block; filter:none; transition:filter .25s ease; }
  .preview.blurred img{ filter:blur(8px) saturate(1.1) brightness(1.05); }
  .overlay{ position:absolute; inset:0; display:grid; place-items:center; text-align:center; padding:10px; }
  .overlay .line{ font-weight:900; letter-spacing:.5px; text-shadow:0 3px 20px rgba(0,0,0,.8); }
  .overlay .chance{ font-size:36px; color:#fff; text-shadow:0 0 18px rgba(255,255,255,.3); }
  .overlay .spins{ font-size:28px; color:#ffd36b; margin-top:8px; text-shadow:0 0 18px rgba(255,179,58,.4); }

  /* Buttons */
  .btn{ height:56px; border-radius:14px; border:none; font-weight:900; font-size:16px; cursor:pointer; }
  .btn.primary{ background:linear-gradient(180deg,#0b77ff,#2b8bff); color:#fff; }
  .btn.secondary{ background:#0b1424; color:#cfe1ff; border:1px solid var(--stroke); display:flex; align-items:center; justify-content:center; }
  .btn:disabled{ opacity:.45; cursor:not-allowed; }

  .spacer{ height:6px; }
</style>
</head>
<body>
  <div class="shell">
    <!-- Top line -->
    <div class="topbar">
      <a class="back" href="index.html" id="backBtn">◀ Back</a>
      <div class="tgbadge">
        <img src="telegram_icon.png" alt="Telegram" class="tgicon" />
        <div>@master_mines_bot</div>
      </div>
    </div>

    <!-- SELECT GAME -->
    <select class="select" id="gameSelect" aria-label="Select slot">
      <option value="">Choose a slot…</option>
      <option>Coin Gobbler</option>
      <option>Alien Fruits</option>
      <option>Luck of Tiger</option>
      <option>Zeus vs Hades</option>
      <option>Luck of Panda</option>
      <option>Santa Mummy</option>
      <option>Mummyland Treasures</option>
      <option>Gates of Olympus 1000</option>
      <option>Pirates Pub</option>
      <option>Sugar Rush</option>
      <option>Sugar Rush 1000</option>
      <option>Sun of Egypt 3</option>
      <option>Sweet Bonanza 1000</option>
      <option>The Dog House</option>
      <option>Wild West Gold</option>
      <option>Don Catleone</option>
      <option>Octo Attack</option>
      <option>Bonanza Billion</option>
    </select>

    <!-- UPLOAD -->
    <div id="uploadWrap" class="drop">
      <div class="hint">
        <div style="font-size:24px;opacity:.9;line-height:1">⬆</div>
        Upload your slot screenshot
      </div>
      <input id="fileInput" type="file" accept="image/*" />
    </div>

    <!-- PREVIEW -->
    <div id="preview" class="preview" style="display:none;height:220px;">
      <img id="previewImg" alt="preview" />
      <div class="overlay">
        <div class="line chance" id="chanceLine">—</div>
        <div class="line spins" id="spinsLine">—</div>
      </div>
    </div>

    <button id="analyzeBtn" class="btn primary" disabled>Analyze</button>
    <button id="againBtn" class="btn secondary" style="display:none">Again</button>
  </div>

<script>
  if (window.Telegram && Telegram.WebApp) { Telegram.WebApp.expand(); }

  const gameSelect = document.getElementById('gameSelect');
  const fileInput  = document.getElementById('fileInput');
  const uploadWrap = document.getElementById('uploadWrap');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const againBtn   = document.getElementById('againBtn');
  const preview    = document.getElementById('preview');
  const previewImg = document.getElementById('previewImg');
  const chanceLine = document.getElementById('chanceLine');
  const spinsLine  = document.getElementById('spinsLine');

  let file = null;

  function canAnalyze(){
    return !!(gameSelect.value && file);
  }

  function refreshAnalyzeState(){
    analyzeBtn.disabled = !canAnalyze();
  }

  gameSelect.addEventListener('change', refreshAnalyzeState);

  fileInput.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0] ? e.target.files[0] : null;
    if (!f) return;
    if (f.size > 10*1024*1024){
      alert('File is too large. Please select up to 10 MB.');
      fileInput.value = '';
      file = null;
      refreshAnalyzeState();
      return;
    }
    file = f;
    const url = URL.createObjectURL(f);
    previewImg.src = url;
    preview.style.display = 'block';
    preview.classList.remove('blurred');
    uploadWrap.style.display = 'none';
    refreshAnalyzeState();
  });

  function hashString(input){
    let h = 2166136261; for (let i=0;i<input.length;i++){ h ^= input.charCodeAt(i); h = Math.imul(h,16777619);} return (h>>>0)||1; }
  function seededInt(min,max,seed){ let x=seed; x^=x<<13; x^=x>>>17; x^=x<<5; const u=(x>>>0)/0xFFFFFFFF; return Math.floor(u*(max-min+1))+min; }
  function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }

  analyzeBtn.addEventListener('click', ()=>{
    if (!canAnalyze()) return;
    const seed = hashString(`${gameSelect.value}|${file.name}|${file.size}`);
    const spinsUntil = seededInt(15, 60, seed);
    const baseProb = 90 - (spinsUntil - 15) * (72 / 45);
    const jitter = seededInt(-7, 7, seed ^ 0xA5A5A5A5);
    const probability = clamp(Math.round(baseProb + jitter), 5, 95);

    chanceLine.textContent = `CHANCE ${probability}%`;
    spinsLine.textContent  = `IN ${spinsUntil} SPINS`;

    preview.classList.add('blurred');

    analyzeBtn.style.display = 'none';
    againBtn.style.display = 'block';
  });

  againBtn.addEventListener('click', ()=>{
    chanceLine.textContent = '—';
    spinsLine.textContent  = '—';
    preview.classList.remove('blurred');
    preview.style.display = 'none';
    uploadWrap.style.display = 'grid';
    file = null;
    fileInput.value = '';
    analyzeBtn.style.display = 'block';
    againBtn.style.display = 'none';
    refreshAnalyzeState();
  });
</script>
</body>
</html>
